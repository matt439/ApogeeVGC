// Missing Items to Add to ItemsMNO.cs
// These items should be inserted at the BEGINNING of the file, before Magnet

// Add these items BEFORE [ItemId.Magnet] (currently line ~23):

// M items start
[ItemId.MachoBrace] = new()
{
    Id = ItemId.MachoBrace,
    Name = "Macho Brace",
    SpriteNum = 269,
    IgnoreKlutz = true,
    Fling = new FlingData { BasePower = 60 },
    OnModifySpe = new OnModifySpeEventInfo((battle, spe, pokemon) =>
    {
        battle.ChainModify(0.5);
        return IntVoidUnion.FromInt(battle.FinalModify(spe));
    }),
    Num = 215,
    Gen = 3,
    // IsNonstandard = "Past", // Used for EV training, may not be in Gen 9
},

[ItemId.Magmarizer] = new()
{
    Id = ItemId.Magmarizer,
    Name = "Magmarizer",
    SpriteNum = 272,
    Fling = new FlingData { BasePower = 80 },
    Num = 323,
    Gen = 4,
},

// [ItemId.Magnet] already exists - keep existing entry

// [ItemId.MagoBerry] already exists - keep existing entry

// Add AFTER MagoBerry, BEFORE MarangaBerry:

[ItemId.MaliciousArmor] = new()
{
    Id = ItemId.MaliciousArmor,
    Name = "Malicious Armor",
    SpriteNum = 744,
    Fling = new FlingData { BasePower = 30 },
    Num = 1861,
    Gen = 9,
},

// [ItemId.MarangaBerry] already exists - keep existing entry
// [ItemId.MasterBall] already exists - keep existing entry
// [ItemId.MasterpieceTeacup] already exists - keep existing entry
// [ItemId.MeadowPlate] already exists - keep existing entry
// [ItemId.MentalHerb] already exists - keep existing entry
// [ItemId.MetalAlloy] already exists - keep existing entry
// [ItemId.MetalCoat] already exists - need to verify this is present

// Add after MetalCoat (if present), or after MetalAlloy:

[ItemId.MetalPowder] = new()
{
    Id = ItemId.MetalPowder,
    Name = "Metal Powder",
    SpriteNum = 287,
    Fling = new FlingData { BasePower = 10 },
    OnModifyDef = new OnModifyDefEventInfo((battle, def, pokemon, _, _) =>
    {
        if (pokemon.BaseSpecies.Name == "Ditto" && !pokemon.Transformed)
        {
            battle.ChainModify(2);
            return battle.FinalModify(def);
        }
        return def;
    }, 2),
    Num = 257,
    Gen = 2,
    // IsNonstandard = "Past", // Ditto-specific item
},

[ItemId.Metronome] = new()
{
    Id = ItemId.Metronome,
    Name = "Metronome",
    SpriteNum = 289,
    Fling = new FlingData { BasePower = 30 },
    OnStart = new OnStartEventInfo((battle, pokemon) =>
    {
        pokemon.AddVolatile(ConditionId.Metronome);
    }),
    // TODO: Condition implementation - boosts damage of consecutively used same move
    Num = 277,
    Gen = 4,
},

[ItemId.MicleBerry] = new()
{
    Id = ItemId.MicleBerry,
    Name = "Micle Berry",
    SpriteNum = 290,
    IsBerry = true,
    NaturalGift = (100, "Rock"),
    OnResidual = new OnResidualEventInfo((battle, pokemon, _, _) =>
    {
        if (pokemon.Hp <= pokemon.MaxHp / 4 || 
            (pokemon.Hp <= pokemon.MaxHp / 2 &&
             pokemon.HasAbility(AbilityId.Gluttony) && 
             pokemon.AbilityState.Gluttony == true))
        {
            pokemon.EatItem();
        }
    }),
    OnEat = new OnEatEventInfo((Action<Battle, Pokemon>)((battle, pokemon) =>
    {
        pokemon.AddVolatile(ConditionId.MicleBerry);
    })),
    // TODO: Condition - boosts accuracy of next move by 1.2x
    Num = 209,
    Gen = 4,
},

[ItemId.MindPlate] = new()
{
    Id = ItemId.MindPlate,
    Name = "Mind Plate",
    SpriteNum = 291,
    OnPlate = "Psychic",
    OnBasePower = new OnBasePowerEventInfo((battle, basePower, user, target, move) =>
    {
        if (move.Type == MoveType.Psychic)
        {
            battle.ChainModify([4915, 4096]);
            return battle.FinalModify(basePower);
        }
        return basePower;
    }, 15),
    // TODO: OnTakeItem - Arceus can't have plates removed
    ForcedForme = "Arceus-Psychic",
    Num = 307,
    Gen = 4,
},

[ItemId.MiracleSeed] = new()
{
    Id = ItemId.MiracleSeed,
    Name = "Miracle Seed",
    SpriteNum = 292,
    Fling = new FlingData { BasePower = 30 },
    OnBasePower = new OnBasePowerEventInfo((battle, basePower, user, target, move) =>
    {
        if (move.Type == MoveType.Grass)
        {
            battle.ChainModify([4915, 4096]);
            return battle.FinalModify(basePower);
        }
        return basePower;
    }, 15),
    Num = 239,
    Gen = 2,
},

[ItemId.MirrorHerb] = new()
{
    Id = ItemId.MirrorHerb,
    Name = "Mirror Herb",
    SpriteNum = 748,
    Fling = new FlingData { BasePower = 30 },
    // TODO: Complex implementation - copies opponent's stat boosts
    // OnFoeAfterBoost, OnAnySwitchIn, OnAnyAfterMega, OnAnyAfterMove, OnResidual, OnUse, OnEnd
    Num = 1883,
    Gen = 9,
},

[ItemId.MistySeed] = new()
{
    Id = ItemId.MistySeed,
    Name = "Misty Seed",
    SpriteNum = 666,
    Fling = new FlingData { BasePower = 10 },
    OnSwitchIn = new OnSwitchInEventInfo((battle, pokemon) =>
    {
        if (!pokemon.IgnoringItem() && 
            battle.Field.IsTerrain(ConditionId.MistyTerrain, null))
        {
            pokemon.UseItem();
        }
    }, -1),
    OnTerrainChange = new OnTerrainChangeEventInfo((battle, pokemon, source, effect) =>
    {
        if (battle.Field.IsTerrain(ConditionId.MistyTerrain, null))
        {
            pokemon.UseItem();
        }
    }),
    Boosts = new SparseBoostsTable { SpD = 1 },
    Num = 883,
    Gen = 7,
},

[ItemId.MoonBall] = new()
{
    Id = ItemId.MoonBall,
    Name = "Moon Ball",
    SpriteNum = 294,
    IsPokeball = true,
    Num = 498,
    Gen = 2,
},

[ItemId.MoonStone] = new()
{
    Id = ItemId.MoonStone,
    Name = "Moon Stone",
    SpriteNum = 295,
    Fling = new FlingData { BasePower = 30 },
    Num = 81,
    Gen = 1,
},

[ItemId.MuscleBand] = new()
{
    Id = ItemId.MuscleBand,
    Name = "Muscle Band",
    SpriteNum = 297,
    Fling = new FlingData { BasePower = 10 },
    OnBasePower = new OnBasePowerEventInfo((battle, basePower, user, target, move) =>
    {
        if (move.Category == MoveCategory.Physical)
        {
            battle.ChainModify([4505, 4096]);
            return battle.FinalModify(basePower);
        }
        return basePower;
    }, 16),
    Num = 266,
    Gen = 4,
},

[ItemId.MysticWater] = new()
{
    Id = ItemId.MysticWater,
    Name = "Mystic Water",
    SpriteNum = 300,
    Fling = new FlingData { BasePower = 30 },
    OnBasePower = new OnBasePowerEventInfo((battle, basePower, user, target, move) =>
    {
        if (move.Type == MoveType.Water)
        {
            battle.ChainModify([4915, 4096]);
            return battle.FinalModify(basePower);
        }
        return basePower;
    }, 15),
    Num = 243,
    Gen = 2,
},

// N items start

[ItemId.NestBall] = new()
{
    Id = ItemId.NestBall,
    Name = "Nest Ball",
    SpriteNum = 303,
    IsPokeball = true,
    Num = 8,
    Gen = 3,
},

[ItemId.NetBall] = new()
{
    Id = ItemId.NetBall,
    Name = "Net Ball",
    SpriteNum = 304,
    IsPokeball = true,
    Num = 6,
    Gen = 3,
},

[ItemId.NeverMeltIce] = new()
{
    Id = ItemId.NeverMeltIce,
    Name = "Never-Melt Ice",
    SpriteNum = 305,
    Fling = new FlingData { BasePower = 30 },
    OnBasePower = new OnBasePowerEventInfo((battle, basePower, user, target, move) =>
    {
        if (move.Type == MoveType.Ice)
        {
            battle.ChainModify([4915, 4096]);
            return battle.FinalModify(basePower);
        }
        return basePower;
    }, 15),
    Num = 246,
    Gen = 2,
},

[ItemId.NormalGem] = new()
{
    Id = ItemId.NormalGem,
    Name = "Normal Gem",
    SpriteNum = 307,
    IsGem = true,
    OnSourceTryPrimaryHit = new OnSourceTryPrimaryHitEventInfo(
        (battle, target, source, move) =>
        {
            if (target == source || move.Category == MoveCategory.Status || 
                move.Flags.PledgeCombo == true) 
                return;
            if (move.Type == MoveType.Normal && source.UseItem())
            {
                source.AddVolatile(ConditionId.Gem);
            }
        }),
    Num = 564,
    Gen = 5,
},

// O items start

[ItemId.OccaBerry] = new()
{
    Id = ItemId.OccaBerry,
    Name = "Occa Berry",
    SpriteNum = 311,
    IsBerry = true,
    NaturalGift = (80, "Fire"),
    OnSourceModifyDamage = new OnSourceModifyDamageEventInfo((battle, damage, source, target, move) =>
    {
        if (move.Type == MoveType.Fire && target.GetMoveHitData(move).TypeMod > 0)
        {
            var hitSub = target.Volatiles.ContainsKey(ConditionId.Substitute) &&
                         move.Flags.BypassSub != true &&
                         !(move.Infiltrates == true && battle.Gen >= 6);
            if (hitSub) return damage;

            if (target.EatItem())
            {
                battle.Debug("-50% reduction");
                battle.Add("-enditem", target, "item: Occa Berry", "[weaken]");
                battle.ChainModify(0.5);
                return battle.FinalModify(damage);
            }
        }
        return damage;
    }),
    OnEat = new OnEatEventInfo((Action<Battle, Pokemon>)((_, _) => { })),
    Num = 184,
    Gen = 4,
},

[ItemId.OddIncense] = new()
{
    Id = ItemId.OddIncense,
    Name = "Odd Incense",
    SpriteNum = 312,
    Fling = new FlingData { BasePower = 10 },
    OnBasePower = new OnBasePowerEventInfo((battle, basePower, user, target, move) =>
    {
        if (move.Type == MoveType.Psychic)
        {
            battle.ChainModify([4915, 4096]);
            return battle.FinalModify(basePower);
        }
        return basePower;
    }, 15),
    Num = 314,
    Gen = 4,
    // IsNonstandard = "Past", // Breeding item
},

[ItemId.OranBerry] = new()
{
    Id = ItemId.OranBerry,
    Name = "Oran Berry",
    SpriteNum = 319,
    IsBerry = true,
    NaturalGift = (80, "Poison"),
    OnUpdate = new OnUpdateEventInfo((battle, pokemon) =>
    {
        if (pokemon.Hp <= pokemon.MaxHp / 2)
        {
            pokemon.EatItem();
        }
    }),
    OnTryEatItem = new OnTryEatItemEventInfo(
        OnTryEatItem.FromFunc((battle, item, pokemon) =>
        {
            var canHeal = battle.RunEvent(EventId.TryHeal, pokemon, null, battle.Effect, 10);
            if (canHeal is BoolRelayVar boolVar && !boolVar.Value)
            {
                return BoolVoidUnion.FromBool(false);
            }
            return BoolVoidUnion.FromVoid();
        })),
    OnEat = new OnEatEventInfo((Action<Battle, Pokemon>)((battle, pokemon) =>
    {
        battle.Heal(10);
    })),
    Num = 155,
    Gen = 3,
},

[ItemId.OvalStone] = new()
{
    Id = ItemId.OvalStone,
    Name = "Oval Stone",
    SpriteNum = 321,
    Fling = new FlingData { BasePower = 80 },
    Num = 110,
    Gen = 4,
},
